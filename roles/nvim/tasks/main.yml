---
- name: Ensure nvim config directory exists
  file:
    path: "{{ config_home }}/nvim"
    state: directory
    mode: '0755'

- name: Remove existing nvim config (if not symlink)
  file:
    path: "{{ config_home }}/nvim/{{ item }}"
    state: absent
  loop:
    - init.lua
    - lua
  when: ansible_facts['os_family'] == "Darwin" or ansible_facts['os_family'] == "Debian" or ansible_facts['os_family'] == "RedHat"

- name: Link neovim init.lua
  file:
    src: "{{ dotfiles_home }}/roles/nvim/files/init.lua"
    dest: "{{ config_home }}/nvim/init.lua"
    state: link
    force: yes

- name: Link neovim lua directory
  file:
    src: "{{ dotfiles_home }}/roles/nvim/files/lua"
    dest: "{{ config_home }}/nvim/lua"
    state: link
    force: yes

- name: Ensure nvim data directory exists
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.local/share/nvim"
    state: directory
    mode: '0755'
